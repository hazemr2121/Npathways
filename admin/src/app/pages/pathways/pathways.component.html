<div class="container">
  <h2 class="page-title text-white">Pathways Management</h2>

  <!-- Notification -->
  <div class="notification" *ngIf="notification.show" [ngClass]="notification.type">
    {{ notification.message }}
  </div>

  <!-- Create Pathway Form -->
  <div class="form-container">
    <h3 class="form-title">Create New Pathway</h3>
    <form (ngSubmit)="createPathway()" class="pathway-form">
      <div class="form-group">
        <label for="name">Name:</label>
        <input
          type="text"
          id="name"
          [(ngModel)]="formModel.name"
          name="name"
          required
          placeholder="Enter pathway name"
          class="form-input"
        />
      </div>

      <div class="form-group">
        <label for="description">Description:</label>
        <textarea
          id="description"
          [(ngModel)]="formModel.description"
          name="description"
          placeholder="Enter pathway description"
          class="form-textarea"
        ></textarea>
      </div>

      <div class="form-group">
        <label>Select Courses:</label>
        <div class="courses-selection">
          <div
            *ngFor="let course of courses"
            class="course-option"
            [class.selected]="course._id && isCourseSelected(course._id)"
            (click)="course._id && toggleCourseSelection(course._id)"
          >
            <input
              type="checkbox"
              [checked]="course._id && isCourseSelected(course._id)"
              (change)="course._id && toggleCourseSelection(course._id)"
              class="course-checkbox"
            />
            <span class="course-name">{{ course.name }}</span>
          </div>
        </div>
      </div>

      <div class="button-group">
        <button type="submit" class="btn btn-primary">Create Pathway</button>
      </div>
    </form>
  </div>

  <!-- Pathways Grid -->
  <div class="pathways-grid">
    <div class="pathway-card" *ngFor="let pathway of pathways">
      <div class="card-header">
        <h3 class="card-title">{{ pathway.name }}</h3>
      </div>

      <div class="card-content">
        <p class="description">
          {{ pathway.description || "No description available" }}
        </p>

        <div class="courses-section">
          <h4>Courses ({{ pathway.courses?.length || 0 }})</h4>
          <div class="courses-list">
            <div class="chips-container">
              <span class="chip" *ngFor="let course of pathway.courses">
                {{ getCourseName(typeof course === 'string' ? course : course._id) }}
                <button
                  class="chip-remove"
                  (click)="removeCourse(pathway._id, typeof course === 'string' ? course : (course._id || ''))"
                >
                  Ã—
                </button>
              </span>
            </div>
          </div>
        </div>
      </div>

      <div class="card-actions">
        <button class="btn btn-icon" (click)="editPathway(pathway)">
          <i class="fas fa-edit"></i>
          Edit
        </button>
        <button class="btn btn-icon btn-danger" (click)="deletePathway(pathway._id)">
          <i class="fas fa-trash"></i>
          Delete
        </button>
      </div>
    </div>
  </div>

  <!-- Edit Dialog -->
  <app-edit-pathway-dialog
    *ngIf="showEditDialog && selectedPathway"
    [pathway]="selectedPathway"
    [courses]="courses"
    (close)="closeEditDialog()"
    (save)="onSavePathway($event)"
  ></app-edit-pathway-dialog>
</div>
